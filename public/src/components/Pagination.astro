---
interface Props {
  currentPage: number;
  totalPages: number;
  baseUrl?: string;
  basePath?: string; // New: for pretty URLs like /page/, /kategori/teknologi/page/
}

const { currentPage, totalPages, baseUrl, basePath } = Astro.props;

const maxVisible = 5;
let startPage = Math.max(1, currentPage - Math.floor(maxVisible / 2));
let endPage = Math.min(totalPages, startPage + maxVisible - 1);

if (endPage - startPage + 1 < maxVisible) {
  startPage = Math.max(1, endPage - maxVisible + 1);
}

const pages = Array.from({ length: endPage - startPage + 1 }, (_, i) => startPage + i);

// Support both query params (?page=X) and pretty URLs (/page/X)
const getPageUrl = (page: number) => {
  // If basePath is provided, use pretty URLs
  if (basePath) {
    // Page 1 goes to base without /page/1
    if (page === 1) {
      // Remove trailing /page from basePath to get root
      const rootPath = basePath.replace(/\/page\/?$/, '') || '/';
      return rootPath;
    }
    return `${basePath}/${page}`;
  }
  
  // Fallback to query params
  const url = new URL(baseUrl || '/', Astro.url);
  url.searchParams.set('page', String(page));
  return url.pathname + url.search;
};
---

{totalPages > 1 && (
  <nav class="pagination" aria-label="Pagination">
    {currentPage > 1 && (
      <a href={getPageUrl(currentPage - 1)} class="page-link prev" aria-label="Previous page">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="15 18 9 12 15 6"></polyline>
        </svg>
      </a>
    )}
    
    {startPage > 1 && (
      <>
        <a href={getPageUrl(1)} class="page-link">1</a>
        {startPage > 2 && <span class="page-ellipsis">...</span>}
      </>
    )}
    
    {pages.map((page) => (
      page === currentPage ? (
        <span class="page-link active" aria-current="page">{page}</span>
      ) : (
        <a href={getPageUrl(page)} class="page-link">{page}</a>
      )
    ))}
    
    {endPage < totalPages && (
      <>
        {endPage < totalPages - 1 && <span class="page-ellipsis">...</span>}
        <a href={getPageUrl(totalPages)} class="page-link">{totalPages}</a>
      </>
    )}
    
    {currentPage < totalPages && (
      <a href={getPageUrl(currentPage + 1)} class="page-link next" aria-label="Next page">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="9 18 15 12 9 6"></polyline>
        </svg>
      </a>
    )}
  </nav>
)}

<style>
  .pagination {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 0.375rem;
    margin-top: 2rem;
    flex-wrap: wrap;
  }
  
  .page-link {
    display: flex;
    align-items: center;
    justify-content: center;
    min-width: 2.5rem;
    height: 2.5rem;
    padding: 0 0.75rem;
    border-radius: var(--radius-md);
    border: 1px solid var(--color-border);
    font-size: 0.875rem;
    font-weight: 500;
    color: var(--color-text);
    background: var(--color-bg);
    transition: all var(--transition-fast);
  }
  
  .page-link:hover:not(.active) {
    background: var(--color-primary);
    color: white;
    border-color: var(--color-primary);
  }
  
  .page-link.active {
    background: var(--color-primary);
    color: white;
    border-color: var(--color-primary);
    cursor: default;
  }
  
  .page-ellipsis {
    padding: 0 0.5rem;
    color: var(--color-text-light);
  }
  
  .prev, .next {
    padding: 0;
  }
</style>
